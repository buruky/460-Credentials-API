openapi: 3.0.0
info:
  title: TCSS-460-auth-squared API with Movie Database
  description: |
    # Authentication × Authorization = Auth² + Movie Database

    **Student Project** for TCSS-460 Web API Development

    This API demonstrates authentication, authorization, and CRUD operations with a movie database. 
    All movie endpoints require authentication via JWT tokens.
    
    ## Authentication Flow
    1. **Register** a new account (`POST /auth/register`) - Creates a basic user (role 1)
    2. **Login** with credentials (`POST /auth/login`) - Returns JWT token
    3. Include token in `Authorization: Bearer <token>` header for protected endpoints
    4. Access movie endpoints with valid authentication
    
    ## Role Hierarchy for Movie Operations
    - **User (1)**: Can view movies (GET operations)
    - **Moderator (2)**: Can add and update movies
    - **Admin (3)**: Can delete movies and manage users
    - **SuperAdmin (4)**: System administration
    - **Owner (5)**: Complete system control
    
    ## Security
    - SHA256 password hashing with unique salts
    - JWT tokens (14-day expiry)
    - Role-based access control for movie operations
    - Input validation and sanitization

  version: 2.0.0
  contact:
    name: TCSS 460 Support
    email: tcss460professor@gmail.com
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

servers:
  - url: http://localhost:8000
    description: Development server
  - url: https://your-production-url.com
    description: Production server

tags:
  - name: Movies
    description: Movie database CRUD operations
  - name: Public Auth
    description: Authentication endpoints (no token required)
  - name: Protected Auth
    description: Authentication endpoints (token required)
  - name: Admin
    description: User management endpoints (admin only)
  - name: Verification
    description: Email and phone verification
  - name: Testing
    description: Development and testing endpoints

paths:
  # ===== MOVIE ENDPOINTS =====
  /api/movies:
    get:
      tags:
        - Movies
      summary: Get all movies
      description: |
        Retrieves a list of all movies in the database.
        
        **Required Role:** User (1) or higher
      operationId: getAllMovies
      security:
        - bearerAuth: []
      responses:
        '200':
          description: List of movies retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      movies:
                        type: array
                        items:
                          $ref: '#/components/schemas/Movie'
              examples:
                movieList:
                  summary: Example movie list
                  value:
                    success: true
                    data:
                      movies:
                        - id: 1
                          title: "The Matrix"
                          year: 1999
                          genre: "Sci-Fi"
                          rating: 8.7
                          director: "Wachowski Brothers"
                        - id: 2
                          title: "Inception"
                          year: 2010
                          genre: "Thriller"
                          rating: 8.8
                          director: "Christopher Nolan"
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '500':
          $ref: '#/components/responses/ServerError'

  /api/movies/page:
    get:
      tags:
        - Movies
      summary: Get movies with pagination
      description: |
        Retrieves movies with pagination, sorting, and filtering options.
        
        **Required Role:** User (1) or higher
      operationId: getMoviesPage
      security:
        - bearerAuth: []
      parameters:
        - name: page
          in: query
          description: Page number (starts at 1)
          required: false
          schema:
            type: integer
            minimum: 1
            default: 1
            example: 1
        - name: limit
          in: query
          description: Number of items per page
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
            example: 10
        - name: sort
          in: query
          description: Field to sort by
          required: false
          schema:
            type: string
            enum: [title, year, rating, genre]
            default: title
            example: rating
        - name: order
          in: query
          description: Sort order
          required: false
          schema:
            type: string
            enum: [asc, desc]
            default: asc
            example: desc
        - name: genre
          in: query
          description: Filter by genre
          required: false
          schema:
            type: string
            example: Sci-Fi
        - name: year
          in: query
          description: Filter by year
          required: false
          schema:
            type: integer
            example: 2010
      responses:
        '200':
          description: Paginated movie list
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      movies:
                        type: array
                        items:
                          $ref: '#/components/schemas/Movie'
                      pagination:
                        $ref: '#/components/schemas/PaginationMeta'
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '500':
          $ref: '#/components/responses/ServerError'

  /api/movies/random:
    get:
      tags:
        - Movies
      summary: Get a random movie
      description: |
        Returns a randomly selected movie from the database.
        
        **Required Role:** User (1) or higher
        
        **Use Cases:**
        - Movie recommendation features
        - "Movie of the day" functionality
        - Testing and development
      operationId: getRandomMovie
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Random movie retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      movie:
                        $ref: '#/components/schemas/MovieDetailed'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          description: No movies found in database
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          $ref: '#/components/responses/ServerError'

  /api/movies/post:
    post:
      tags:
        - Movies
      summary: Create a new movie
      description: |
        Creates a new movie entry in the database.
        
        **Required Role:** Moderator (2) or higher
        
        **Validation Rules:**
        - Title: Required, 1-255 characters
        - Year: Required, between 1888 and current year + 5
        - Genre: Required, valid genre from predefined list
        - Rating: Optional, between 0.0 and 10.0
        - Director: Required, 1-255 characters
      operationId: createMovie
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MovieCreateRequest'
            examples:
              newMovie:
                summary: Creating a new movie
                value:
                  title: "Interstellar"
                  year: 2014
                  genre: "Sci-Fi"
                  rating: 8.6
                  director: "Christopher Nolan"
                  description: "A team of explorers travel through a wormhole in space"
                  cast: ["Matthew McConaughey", "Anne Hathaway", "Jessica Chastain"]
      responses:
        '201':
          description: Movie created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: Movie created successfully
                  data:
                    type: object
                    properties:
                      movie:
                        $ref: '#/components/schemas/MovieDetailed'
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '409':
          description: Movie already exists
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          $ref: '#/components/responses/ServerError'

  /api/movies/patchID/{id}:
    patch:
      tags:
        - Movies
      summary: Update movie (partial)
      description: |
        Updates specific fields of an existing movie. Only provided fields will be updated.
        
        **Required Role:** Moderator (2) or higher
        
        **Updatable Fields:**
        - title, year, genre, rating, director, description, cast
      operationId: updateMovie
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Movie ID
          schema:
            type: integer
            example: 42
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MovieUpdateRequest'
            examples:
              updateRating:
                summary: Update rating only
                value:
                  rating: 8.7
              updateMultiple:
                summary: Update multiple fields
                value:
                  rating: 8.7
                  description: "Updated movie description"
                  cast: ["Actor 1", "Actor 2"]
      responses:
        '200':
          description: Movie updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: Movie updated successfully
                  data:
                    type: object
                    properties:
                      movie:
                        $ref: '#/components/schemas/MovieDetailed'
                      updatedFields:
                        type: array
                        items:
                          type: string
                        example: ["rating", "description"]
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '500':
          $ref: '#/components/responses/ServerError'

  /api/movies/deleteID/{id}:
    delete:
      tags:
        - Movies
      summary: Delete a movie
      description: |
        Permanently deletes a movie from the database.
        
        **Required Role:** Admin (3) or higher
        
        **Warning:** This action cannot be undone.
      operationId: deleteMovie
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Movie ID to delete
          schema:
            type: integer
            example: 42
      responses:
        '200':
          description: Movie deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: Movie deleted successfully
                  data:
                    type: object
                    properties:
                      deletedId:
                        type: integer
                        example: 42
                      deletedTitle:
                        type: string
                        example: "Inception"
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '500':
          $ref: '#/components/responses/ServerError'

  /api/movies/getID/{id}:
    get:
      tags:
        - Movies
      summary: Get movie by ID
      description: |
        Retrieves detailed information for a specific movie.
        
        **Required Role:** User (1) or higher
      operationId: getMovieById
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Movie ID
          schema:
            type: integer
            example: 42
      responses:
        '200':
          description: Movie details retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      movie:
                        $ref: '#/components/schemas/MovieDetailed'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '500':
          $ref: '#/components/responses/ServerError'

  # ===== PUBLIC AUTH ENDPOINTS =====
  /auth/register:
    post:
      tags:
        - Public Auth
      summary: Register new user account
      description: |
        Creates a new user account with role 1 (User).
        
        **Validation Rules:**
        - Email must be unique and valid format
        - Username must be unique, 3-50 chars, alphanumeric + underscore/hyphen
        - Password must be 8-128 characters
        - Phone must be at least 10 digits
        
        **Account Status:** New accounts are created with 'pending' status until verified.
      operationId: registerUser
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RegisterRequest'
      responses:
        '201':
          description: Registration successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
        '400':
          $ref: '#/components/responses/ValidationError'
        '500':
          $ref: '#/components/responses/ServerError'

  /auth/login:
    post:
      tags:
        - Public Auth
      summary: Login with credentials
      description: |
        Authenticates user and returns JWT token.
        
        **Account Restrictions:**
        - Suspended accounts receive 403 error
        - Locked accounts receive 403 error
        - Unverified accounts can login but have limited access
      operationId: loginUser
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '500':
          $ref: '#/components/responses/ServerError'

  /auth/password/reset-request:
    post:
      tags:
        - Public Auth
      summary: Request password reset
      description: |
        Sends password reset email if account exists and email is verified.
        
        **Security:** Always returns same message regardless of email existence.
        
        **Token Expiry:** Reset tokens expire in 1 hour.
      operationId: requestPasswordReset
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
              properties:
                email:
                  type: string
                  format: email
                  description: Account email address
      responses:
        '200':
          description: Request processed (check email if account exists)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '500':
          $ref: '#/components/responses/ServerError'

  /auth/password/reset:
    post:
      tags:
        - Public Auth
      summary: Reset password with token
      description: |
        Resets password using token from reset email.
        
        **Token Requirements:**
        - Must be valid JWT token
        - Must have type 'password_reset'
        - Must not be expired (1 hour limit)
      operationId: resetPassword
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - token
                - password
              properties:
                token:
                  type: string
                  description: Reset token from email
                password:
                  type: string
                  format: password
                  minLength: 8
                  maxLength: 128
                  description: New password
      responses:
        '200':
          description: Password reset successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '400':
          $ref: '#/components/responses/ValidationError'
        '500':
          $ref: '#/components/responses/ServerError'

  # ===== PROTECTED AUTH ENDPOINTS =====
  /jwt_test:
    get:
      tags:
        - Testing
      summary: Test JWT token validity
      description: Simple health check endpoint to verify API is running.
      operationId: testJWT
      responses:
        '200':
          description: API is working
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Hello World! API is working correctly.
                  timestamp:
                    type: string
                    format: date-time
                  service:
                    type: string
                    example: TCSS-460-auth-squared

  /auth/user/password/change:
    post:
      tags:
        - Protected Auth
      summary: Change password
      description: |
        Changes user password (requires old password verification).
        
        **Requirements:**
        - Must provide correct old password
        - New password must be different from old
        - Updates account timestamp
      operationId: changePassword
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - oldPassword
                - newPassword
              properties:
                oldPassword:
                  type: string
                  format: password
                  description: Current password
                newPassword:
                  type: string
                  format: password
                  minLength: 8
                  maxLength: 128
                  description: New password (must be different)
      responses:
        '200':
          description: Password changed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '500':
          $ref: '#/components/responses/ServerError'

  # ===== ADMIN ENDPOINTS =====
  /admin/users:
    get:
      tags:
        - Admin
      summary: Get all users
      description: |
        Retrieves list of all users with filtering and pagination.
        
        **Required Role:** Admin (3) or higher
      operationId: getAllUsers
      security:
        - bearerAuth: []
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
            maximum: 100
        - name: status
          in: query
          schema:
            type: string
            enum: [active, pending, suspended, locked, deleted]
        - name: role
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 5
      responses:
        '200':
          description: Users retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      users:
                        type: array
                        items:
                          $ref: '#/components/schemas/UserDetails'
                      pagination:
                        $ref: '#/components/schemas/PaginationMeta'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'

  /admin/users/{id}/role:
    put:
      tags:
        - Admin
      summary: Change user role
      description: |
        Updates a user's role level.
        
        **Required Role:** Admin (3) or higher
        
        **Role Hierarchy Rules:**
        - Admin (3) can assign roles 1-3
        - SuperAdmin (4) can assign roles 1-4
        - Cannot change your own role
        - Cannot promote to higher role than your own
      operationId: changeUserRole
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - role
              properties:
                role:
                  type: integer
                  minimum: 1
                  maximum: 5
                  description: New role level
      responses:
        '200':
          description: Role changed successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
                  data:
                    type: object
                    properties:
                      user:
                        $ref: '#/components/schemas/UserDetails'
                      previousRole:
                        type: object
                        properties:
                          role:
                            type: string
                          roleLevel:
                            type: integer
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'

  /admin/users/search:
    get:
      tags:
        - Admin
      summary: Search users
      description: |
        Search for users by name, email, or username.
        
        **Required Role:** Admin (3) or higher
      operationId: searchUsers
      security:
        - bearerAuth: []
      parameters:
        - name: q
          in: query
          required: true
          description: Search term
          schema:
            type: string
        - name: fields
          in: query
          description: Fields to search (comma-separated)
          schema:
            type: string
            default: firstname,lastname,email,username
      responses:
        '200':
          description: Search results
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      users:
                        type: array
                        items:
                          $ref: '#/components/schemas/UserDetails'
                      searchTerm:
                        type: string
                      fieldsSearched:
                        type: array
                        items:
                          type: string
                      pagination:
                        $ref: '#/components/schemas/PaginationMeta'

  # ===== VERIFICATION ENDPOINTS =====
  /auth/verify/carriers:
    get:
      tags:
        - Verification
      summary: Get supported SMS carriers
      description: Returns list of supported carriers for SMS verification via email gateway.
      operationId: getCarriers
      responses:
        '200':
          description: List of carriers
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      carriers:
                        type: array
                        items:
                          type: object
                          properties:
                            id:
                              type: string
                              example: att
                            name:
                              type: string
                              example: AT&T
                            gateway:
                              type: string
                              example: '@txt.att.net'

  /auth/verify/email/confirm:
    get:
      tags:
        - Verification
      summary: Verify email via link
      description: |
        Verifies email address using token from verification email.
        
        **Token Requirements:**
        - Must match stored verification token
        - Must not be expired (48 hour limit)
        - Can only be used once
      operationId: confirmEmail
      parameters:
        - name: token
          in: query
          required: true
          schema:
            type: string
          description: Verification token from email
      responses:
        '200':
          description: Email verified successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '400':
          $ref: '#/components/responses/ValidationError'
        '500':
          $ref: '#/components/responses/ServerError'

  /auth/verify/phone/send:
    post:
      tags:
        - Verification
      summary: Send SMS verification code
      description: |
        Sends 6-digit verification code via SMS (email-to-SMS gateway).
        
        **Rate Limiting:** 1 request per minute
        
        **Code Expiry:** 15 minutes
      operationId: sendPhoneVerification
      security:
        - bearerAuth: []
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                carrier:
                  type: string
                  description: Optional carrier ID
                  example: att
      responses:
        '200':
          description: Verification code sent
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      expiresIn:
                        type: string
                        example: 15 minutes
        '429':
          $ref: '#/components/responses/RateLimitError'

  /auth/verify/phone/verify:
    post:
      tags:
        - Verification
      summary: Verify SMS code
      description: |
        Verifies 6-digit code sent via SMS.
        
        **Attempt Limit:** 3 attempts per code
      operationId: verifyPhone
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - code
              properties:
                code:
                  type: string
                  pattern: '^\d{6}$'
                  description: 6-digit verification code
                  example: "123456"
      responses:
        '200':
          description: Phone verified successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '400':
          $ref: '#/components/responses/ValidationError'
        '429':
          $ref: '#/components/responses/RateLimitError'

  /auth/verify/email/send:
    post:
      tags:
        - Verification
      summary: Send email verification
      description: |
        Sends verification email with link.
        
        **Rate Limiting:** 1 request per 5 minutes
        
        **Token Expiry:** 48 hours
      operationId: sendEmailVerification
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Verification email sent
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      expiresIn:
                        type: string
                        example: 48 hours
        '429':
          $ref: '#/components/responses/RateLimitError'

components:
  # ===== SECURITY SCHEMES =====
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: |
        JWT token from login or registration.
        
        Format: `Bearer <token>`
        
        Expiry: 14 days

  # ===== SCHEMAS =====
  schemas:
    Movie:
      type: object
      properties:
        id:
          type: integer
          example: 1
        title:
          type: string
          example: "The Matrix"
        year:
          type: integer
          example: 1999
        genre:
          type: string
          example: "Sci-Fi"
        rating:
          type: number
          format: float
          minimum: 0
          maximum: 10
          example: 8.7
        director:
          type: string
          example: "Wachowski Brothers"

    MovieDetailed:
      allOf:
        - $ref: '#/components/schemas/Movie'
        - type: object
          properties:
            description:
              type: string
              example: "A computer hacker learns about the true nature of reality"
            cast:
              type: array
              items:
                type: string
              example: ["Keanu Reeves", "Laurence Fishburne", "Carrie-Anne Moss"]
            duration:
              type: integer
              description: Duration in minutes
              example: 136
            created_at:
              type: string
              format: date-time
              example: "2024-01-15T10:30:00Z"
            updated_at:
              type: string
              format: date-time
              example: "2024-06-20T14:45:00Z"

    MovieCreateRequest:
      type: object
      required:
        - title
        - year
        - genre
        - director
      properties:
        title:
          type: string
          minLength: 1
          maxLength: 255
          example: "Interstellar"
        year:
          type: integer
          minimum: 1888
          maximum: 2030
          example: 2014
        genre:
          type: string
          enum: [Action, Adventure, Animation, Comedy, Crime, Documentary, Drama, Family, Fantasy, Horror, Mystery, Romance, Sci-Fi, Thriller, War, Western]
          example: "Sci-Fi"
        rating:
          type: number
          format: float
          minimum: 0
          maximum: 10
          example: 8.6
        director:
          type: string
          minLength: 1
          maxLength: 255
          example: "Christopher Nolan"
        description:
          type: string
          maxLength: 2000
          example: "A team of explorers travel through a wormhole"
        cast:
          type: array
          items:
            type: string
          example: ["Matthew McConaughey", "Anne Hathaway"]
        duration:
          type: integer
          minimum: 1
          maximum: 600
          example: 169

    MovieUpdateRequest:
      type: object
      properties:
        title:
          type: string
          minLength: 1
          maxLength: 255
        year:
          type: integer
          minimum: 1888
          maximum: 2030
        genre:
          type: string
          enum: [Action, Adventure, Animation, Comedy, Crime, Documentary, Drama, Family, Fantasy, Horror, Mystery, Romance, Sci-Fi, Thriller, War, Western]
        rating:
          type: number
          format: float
          minimum: 0
          maximum: 10
        director:
          type: string
          minLength: 1
          maxLength: 255
        description:
          type: string
          maxLength: 2000
        cast:
          type: array
          items:
            type: string
        duration:
          type: integer
          minimum: 1
          maximum: 600

    RegisterRequest:
      type: object
      required:
        - firstname
        - lastname
        - email
        - username
        - password
        - phone
      properties:
        firstname:
          type: string
          minLength: 1
          maxLength: 100
          example: John
        lastname:
          type: string
          minLength: 1
          maxLength: 100
          example: Doe
        email:
          type: string
          format: email
          example: john.doe@example.com
        username:
          type: string
          minLength: 3
          maxLength: 50
          pattern: '^[a-zA-Z0-9_-]+$'
          example: johndoe
        password:
          type: string
          format: password
          minLength: 8
          maxLength: 128
          example: SecurePass123!
        phone:
          type: string
          pattern: '^\d{10,}$'
          example: "2065551234"

    LoginRequest:
      type: object
      required:
        - email
        - password
      properties:
        email:
          type: string
          format: email
          example: john.doe@example.com
        password:
          type: string
          format: password
          example: SecurePass123!

    AuthResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        message:
          type: string
          example: Login successful
        data:
          type: object
          properties:
            accessToken:
              type: string
              description: JWT access token
              example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
            user:
              $ref: '#/components/schemas/UserInfo'

    UserInfo:
      type: object
      properties:
        id:
          type: integer
          example: 123
        email:
          type: string
          format: email
          example: john.doe@example.com
        name:
          type: string
          example: John
        lastname:
          type: string
          example: Doe
        username:
          type: string
          example: johndoe
        role:
          type: string
          enum: [User, Moderator, Admin, SuperAdmin, Owner]
          example: User
        emailVerified:
          type: boolean
          example: false
        phoneVerified:
          type: boolean
          example: false
        accountStatus:
          type: string
          enum: [pending, active, suspended, locked, deleted]
          example: pending

    UserDetails:
      allOf:
        - $ref: '#/components/schemas/UserInfo'
        - type: object
          properties:
            firstName:
              type: string
              example: John
            lastName:
              type: string
              example: Doe
            phone:
              type: string
              example: "2065551234"
            roleLevel:
              type: integer
              minimum: 1
              maximum: 5
              example: 1
            createdAt:
              type: string
              format: date-time
              example: '2024-01-15T10:30:00Z'
            updatedAt:
              type: string
              format: date-time
              example: '2024-01-15T10:30:00Z'

    SuccessResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        message:
          type: string
          example: Operation successful
        data:
          type: object
          nullable: true

    ErrorResponse:
      type: object
      properties:
        success:
          type: boolean
          example: false
        message:
          type: string
          example: Error message
        errorCode:
          type: string
          example: AUTH001

    ValidationErrorResponse:
      type: object
      properties:
        success:
          type: boolean
          example: false
        message:
          type: string
          example: Validation failed
        errors:
          type: array
          items:
            type: object
            properties:
              field:
                type: string
                example: email
              message:
                type: string
                example: Invalid email format

    PaginationMeta:
      type: object
      properties:
        page:
          type: integer
          example: 1
        limit:
          type: integer
          example: 20
        totalItems:
          type: integer
          example: 150
        totalPages:
          type: integer
          example: 8

  # ===== RESPONSES =====
  responses:
    ValidationError:
      description: Validation error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ValidationErrorResponse'

    UnauthorizedError:
      description: Authentication required
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          examples:
            noToken:
              value:
                success: false
                message: Auth token is not supplied
                errorCode: AUTH009
            invalidCredentials:
              value:
                success: false
                message: Invalid credentials
                errorCode: AUTH001

    ForbiddenError:
      description: Access forbidden
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          examples:
            invalidToken:
              value:
                success: false
                message: Token is not valid
                errorCode: AUTH007
            insufficientRole:
              value:
                success: false
                message: Insufficient permissions
                errorCode: AUTH009
            accountSuspended:
              value:
                success: false
                message: Account is suspended. Please contact support.
                errorCode: AUTH005

    NotFoundError:
      description: Resource not found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          examples:
            movieNotFound:
              value:
                success: false
                message: Movie not found
                errorCode: MOVIE001
            userNotFound:
              value:
                success: false
                message: User not found
                errorCode: USER001

    RateLimitError:
      description: Rate limit exceeded
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          examples:
            tooManyRequests:
              value:
                success: false
                message: Please wait before requesting again
                errorCode: VRFY006

    ServerError:
      description: Internal server error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          examples:
            databaseError:
              value:
                success: false
                message: Server error - contact support
                errorCode: SRVR001